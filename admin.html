<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - SPN POLDA JATIM</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="notification_styles.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“Š</text></svg>">
</head>
<body>
    <div class="admin-container" role="application">
        <!-- Sidebar -->
        <nav class="admin-sidebar" role="navigation" aria-label="Sidebar Navigation" id="adminSidebar">
            <div class="sidebar-header">
                <div class="logo-section">
                    <img src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“Š</text></svg>" alt="Logo" class="sidebar-logo">
                    <div>
                        <h3>SPN POLDA JATIM</h3>
                        <span class="sidebar-subtitle">Dashboard Admin</span>
                    </div>
                </div>
                <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle Sidebar" aria-controls="adminSidebar" aria-expanded="true" type="button">
                    <i class="fa-solid fa-bars" aria-hidden="true"></i>
                </button>
            </div>

            <ul class="sidebar-menu" role="menubar">
                <li class="menu-item active" role="none">
                    <a href="#dashboard" role="menuitem" tabindex="0">
                        <i class="fa-solid fa-chart-line" aria-hidden="true"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="menu-item" role="none">
                    <a href="spreadsheet.html" role="menuitem" tabindex="0">
                        <i class="fa-solid fa-table" aria-hidden="true"></i>
                        <span>Spreadsheet</span>
                    </a>
                </li>
                <li class="menu-item" role="none">
                    <a href="folder.html" role="menuitem" tabindex="0">
                        <i class="fa-solid fa-folder" aria-hidden="true"></i>
                        <span>Folder</span>
                    </a>
                </li>
                <li class="menu-item" role="none">
                    <a href="#users" role="menuitem" tabindex="0">
                        <i class="fa-solid fa-users" aria-hidden="true"></i>
                        <span>Users</span>
                    </a>
                </li>
                <li class="menu-item" role="none">
                    <a href="#settings" role="menuitem" tabindex="0">
                        <i class="fa-solid fa-cog" aria-hidden="true"></i>
                        <span>Settings</span>
                    </a>
                </li>
            </ul>

            <div class="sidebar-footer">
                <div class="user-profile">
                    <img src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ‘¤</text></svg>" alt="Admin" class="user-avatar">
                    <div class="user-info">
                        <span class="user-name">Administrator</span>
                        <span class="user-role">Super Admin</span>
                    </div>
                </div>
                <button class="logout-btn" onclick="logout()">
                    <i class="fa-solid fa-sign-out-alt" aria-hidden="true"></i>
                    <span>Logout</span>
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="admin-main">
            <!-- Admin Header -->
            <header class="admin-header">
                <div class="header-icons">
                    <button class="icon-btn sidebar-toggle-mobile" id="sidebarToggleMobile" aria-label="Toggle Sidebar">
                        <i class="fa-solid fa-bars"></i>
                    </button>
                </div>

                <div class="header-left">
                    <h1>Dashboard Admin</h1>
                    <nav class="breadcrumb">
                        <span class="breadcrumb-item active">Dashboard</span>
                    </nav>
                </div>

                <div class="header-right">
                    <div class="header-notifications">
                        <button class="notification-btn" id="notificationBtn" aria-label="Notifications">
                            <i class="fa-solid fa-bell"></i>
                            <span class="notification-badge">3</span>
                        </button>
                    </div>

                    <div class="header-date">
                        <i class="fa-solid fa-calendar"></i>
                        <span id="currentDate">Loading...</span>
                    </div>

                    <div class="header-actions">
                        <button class="action-btn primary" id="refreshBtn">
                            <i class="fa-solid fa-sync-alt"></i>
                            <span>Refresh</span>
                        </button>

                        <div class="header-menu-dropdown">
                            <button class="menu-dropdown-btn" id="menuDropdownBtn" aria-expanded="false">
                                <i class="fa-solid fa-ellipsis-v"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Dashboard Content -->
            <div class="dashboard-content">
                <!-- Welcome Section -->
                <section class="welcome-section">
                    <div class="welcome-content">
                        <h2>Selamat Datang di Dashboard Admin</h2>
                        <p>Kelola data SPN POLDA JATIM dengan mudah dan efisien</p>
                        <div class="welcome-stats">
                            <div class="welcome-stat">
                                <i class="fa-solid fa-calendar-day"></i>
                                <span id="currentDateWelcome">Loading...</span>
                            </div>
                            <div class="welcome-stat">
                                <i class="fa-solid fa-clock"></i>
                                <span id="currentTime">Loading...</span>
                            </div>
                        </div>
                    </div>
                    <div class="welcome-actions">
                        <button class="btn-secondary" onclick="window.location.href='spreadsheet.html'">
                            <i class="fa-solid fa-table"></i>
                            Lihat Spreadsheet
                        </button>
                    </div>
                </section>

                <!-- Statistics Row -->
                <section class="stats-row">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fa-solid fa-file-spreadsheet"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalSpreadsheets">0</h3>
                            <p>Total Spreadsheet</p>
                            <span class="stat-change positive" id="spreadsheetChange">+0 hari ini</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fa-solid fa-upload"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalUploads">0</h3>
                            <p>Total Upload</p>
                            <span class="stat-change positive" id="uploadChange">+0 hari ini</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fa-solid fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalUsers">0</h3>
                            <p>Total Pengguna</p>
                            <span class="stat-change neutral" id="userChange">0 hari ini</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fa-solid fa-database"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalData">0</h3>
                            <p>Total Data PBJ</p>
                            <span class="stat-change positive" id="dataChange">+0 hari ini</span>
                        </div>
                    </div>
                </section>

                <!-- Charts Row -->
                <section class="charts-row">
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>Status Overview</h3>
                            <div class="chart-actions">
                                <button class="chart-toggle" data-chart="status">Bar</button>
                                <button class="chart-toggle active" data-chart="status">Pie</button>
                            </div>
                        </div>
                        <div class="chart-content">
                            <canvas id="statusChart" width="300" height="200"></canvas>
                        </div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>Upload Activity</h3>
                            <div class="chart-actions">
                                <select id="timeRange">
                                    <option value="7">7 hari</option>
                                    <option value="30">30 hari</option>
                                    <option value="90">90 hari</option>
                                </select>
                            </div>
                        </div>
                        <div class="chart-content">
                            <canvas id="activityChart" width="300" height="200"></canvas>
                        </div>
                    </div>
                </section>

                <!-- Tables Row -->
                <section class="tables-row">
                    <div class="table-container">
                <div class="table-header">
                    <h3>Data PBJ Terbaru</h3>
                    <div class="table-actions">
                        <div class="search-container">
                            <label for="tableSearch" class="sr-only">Cari data PBJ</label>
                            <i class="fa-solid fa-search" aria-hidden="true"></i>
                            <input type="text" id="tableSearch" placeholder="Cari data..." aria-describedby="search-help">
                            <div id="search-help" class="sr-only">Ketik untuk mencari data berdasarkan nomor, subsatker, kegiatan, atau penyedia</div>
                        </div>
                        <button class="btn-secondary" onclick="exportTable()" aria-label="Export data ke format CSV">
                            <i class="fa-solid fa-download" aria-hidden="true"></i>
                            Export
                        </button>
                        <button class="btn-danger" onclick="clearAllTableData()" aria-label="Hapus semua data tabel">
                            <i class="fa-solid fa-trash" aria-hidden="true"></i>
                            Clear All Data
                        </button>
                    </div>
                </div>
                        <div class="table-wrapper">
                            <table class="styled-table" id="dataTable">
                                <thead>
                                    <tr>
                                        <th data-sort="no">NO</th>
                                        <th data-sort="subsaker">SUBSATKER</th>
                                        <th data-sort="kegiatan">KEGIATAN / SUB<br>KEGIATAN / JENIS<br>BELANJA / RINCIAN<br>BELANJA</th>
                                        <th data-sort="nomorKontrak">NOMOR KONTRAK</th>
                                        <th data-sort="kodeMak">KODE MAK</th>
                                        <th data-sort="nilaiKontrak">NILAI KONTRAK</th>
                                        <th data-sort="penyedia">PENYEDIA</th>
                                        <th data-sort="tanggalKontrak">TANGGAL KONTRAK</th>
                                        <th data-sort="tglAkhirKontrak">TGL AKHIR<br>KONTRAK</th>
                                        <th data-sort="kontrak">KONTRAK</th>
                                        <th data-sort="dokumenProses">DOKUMEN PROSES</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="tableBody">
                                    <!-- Data will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        <div class="table-footer">
                            <div class="table-info">
                                <span id="tableInfo">Menampilkan 0 dari 0 data</span>
                            </div>
                            <div class="pagination">
                                <button class="page-btn" id="prevBtn" disabled>
                                    <i class="fa-solid fa-chevron-left"></i>
                                </button>
                                <span id="pageNumbers"></span>
                                <button class="page-btn" id="nextBtn" disabled>
                                    <i class="fa-solid fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Activity and Quick Actions Row -->
                <section class="activity-row">
                    <div class="activity-container">
                        <div class="activity-header">
                            <h3>Aktivitas Terbaru</h3>
                            <button class="btn-link" onclick="clearActivity()">Bersihkan</button>
                        </div>
                        <div class="activity-list" id="activityList">
                            <!-- Activity items will be populated by JavaScript -->
                        </div>
                    </div>

                    <div class="quick-actions-container">
                        <div class="quick-actions-header">
                            <h3>Aksi Cepat</h3>
                        </div>
                        <div class="quick-actions-grid">
                            <button class="quick-action-btn" onclick="window.location.href='upload.html'">
                                <i class="fa-solid fa-upload"></i>
                                <span>Upload Data</span>
                            </button>
                            <button class="quick-action-btn" onclick="window.location.href='spreadsheet.html'">
                                <i class="fa-solid fa-table"></i>
                                <span>Lihat Spreadsheet</span>
                            </button>
                            <button class="quick-action-btn" onclick="window.location.href='folder.html'">
                                <i class="fa-solid fa-folder"></i>
                                <span>Kelola Folder</span>
                            </button>
                            <button class="quick-action-btn" onclick="showSettings()">
                                <i class="fa-solid fa-cog"></i>
                                <span>Pengaturan</span>
                            </button>
                            <button class="quick-action-btn" onclick="generateReport()">
                                <i class="fa-solid fa-chart-bar"></i>
                                <span>Generate Laporan</span>
                            </button>
                            <button class="quick-action-btn" onclick="backupData()">
                                <i class="fa-solid fa-save"></i>
                                <span>Backup Data</span>
                            </button>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <!-- Notification Panel -->
        <div class="notification-panel" id="notificationPanel" style="display: none;">
            <div class="notification-header">
                <h3>Notifikasi</h3>
                <button class="close-btn" onclick="closeNotifications()">
                    <i class="fa-solid fa-times"></i>
                </button>
            </div>
            <div class="notification-list" id="notificationList">
                <!-- Notifications will be populated by JavaScript -->
            </div>
        </div>

        <!-- Modals -->
        <div class="modal" id="settingsModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Pengaturan</h3>
                    <button class="close-btn" onclick="closeModal('settingsModal')">
                        <i class="fa-solid fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="settings-section">
                        <h4>Tampilan</h4>
                        <div class="setting-item">
                            <label for="themeSelect">Tema:</label>
                            <select id="themeSelect">
                                <option value="light">Terang</option>
                                <option value="dark">Gelap</option>
                                <option value="auto">Otomatis</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="admin_animations.js"></script>
    <script src="notifications.js"></script>
    <script>
        // Global variables
        let currentPage = 1;
        let itemsPerPage = 10;
        let currentSort = { column: 'no', direction: 'asc' };
        let tableData = [];
        let filteredData = [];

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            loadDashboardData();
            setupEventListeners();
            updateDateTime();
        });

        // Initialize dashboard components
        function initializeDashboard() {
            // Set theme from localStorage
            const theme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', theme);

            // Initialize charts
            initializeCharts();

            // Load initial data
            loadTableData();
            loadActivityData();
            loadNotifications();
        }

        // Update date and time
        function updateDateTime() {
            const now = new Date();
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit' };

            document.getElementById('currentDate').textContent = now.toLocaleDateString('id-ID', dateOptions);
            document.getElementById('currentDateWelcome').textContent = now.toLocaleDateString('id-ID', { month: 'long', day: 'numeric', year: 'numeric' });
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('id-ID', timeOptions);

            // Update every second
            setTimeout(updateDateTime, 1000);
        }

        // Load dashboard statistics
        function loadDashboardData() {
            const spreadsheets = JSON.parse(localStorage.getItem('spreadsheets')) || [];
            const uploads = JSON.parse(localStorage.getItem('uploads')) || [];
            const users = JSON.parse(localStorage.getItem('users')) || [];

            // Calculate today's uploads
            const today = new Date().toDateString();
            const todaySpreadsheets = spreadsheets.filter(item => new Date(item.uploadDate).toDateString() === today).length;
            const todayUploads = uploads.filter(item => new Date(item.uploadDate).toDateString() === today).length;

            // Update statistics
            document.getElementById('totalSpreadsheets').textContent = spreadsheets.length;
            document.getElementById('totalUploads').textContent = uploads.length;
            document.getElementById('totalUsers').textContent = users.length;
            document.getElementById('totalData').textContent = spreadsheets.reduce((sum, item) => sum + (item.no || 0), 0);

            // Update changes
            document.getElementById('spreadsheetChange').textContent = `+${todaySpreadsheets} hari ini`;
            document.getElementById('uploadChange').textContent = `+${todayUploads} hari ini`;
            document.getElementById('userChange').textContent = `0 hari ini`;
            document.getElementById('dataChange').textContent = `+${todaySpreadsheets} hari ini`;
        }

        // Initialize charts
        function initializeCharts() {
            // Status Overview Chart
            const statusCtx = document.getElementById('statusChart').getContext('2d');
            const statusData = {
                labels: ['Clear', 'Proses', 'Pending'],
                datasets: [{
                    data: [65, 25, 10],
                    backgroundColor: ['#10b981', '#f59e0b', '#ef4444'],
                    borderWidth: 0
                }]
            };

            new Chart(statusCtx, {
                type: 'pie',
                data: statusData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Activity Chart
            const activityCtx = document.getElementById('activityChart').getContext('2d');
            const activityData = {
                labels: ['Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab', 'Min'],
                datasets: [{
                    label: 'Upload',
                    data: [12, 19, 3, 5, 2, 3, 9],
                    backgroundColor: 'rgba(99, 102, 241, 0.2)',
                    borderColor: 'rgba(99, 102, 241, 1)',
                    borderWidth: 2,
                    fill: true
                }]
            };

            new Chart(activityCtx, {
                type: 'line',
                data: activityData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Load table data
        function loadTableData() {
            let spreadsheets = JSON.parse(localStorage.getItem('spreadsheets')) || [];

            // If no data exists, load sample data
            if (spreadsheets.length === 0) {
                spreadsheets = [
                    {
                        "id": 1,
                        "no": 1,
                        "subsaker": "URYANMA",
                        "kegiatan": "PENGADAAN MAKAN JAGA KAWAL SPN POLDA JATIM T.A 2025",
                        "nomorKontrak": "SP/1/XII/2024/SPN",
                        "kodeMak": "BD.3096.EBA.962.003.JW.521112",
                        "nilaiKontrak": 225205000,
                        "penyedia": "WARUNG BUDARMAN",
                        "tanggalKontrak": "30 Desember 2024",
                        "tglAkhirKontrak": "31 Desember 2024",
                        "kontrak": "CLEAR",
                        "dokumenProses": "SUDAH",
                        "name": "Data PBJ 2025",
                        "description": "Data pengadaan SPN POLDA JATIM 2025",
                        "link": "sample_data",
                        "uploadDate": new Date().toLocaleDateString('id-ID'),
                        "uploadTime": new Date().toLocaleTimeString('id-ID'),
                        "type": "sample"
                    },
                    {
                        "id": 2,
                        "no": 2,
                        "subsaker": "URYANMA",
                        "kegiatan": "PENGADAAN JASA PAKET KEBERSIHAN (CLEANING SERVICE) SPN POLDA JATIM T.A 2025",
                        "nomorKontrak": "SP/2/XII/2024/SPN",
                        "kodeMak": "BP.5059.EBA.994.002.FX.523111",
                        "nilaiKontrak": 123540000,
                        "penyedia": "CV. ALIF UTAMA",
                        "tanggalKontrak": "30 Desember 2024",
                        "tglAkhirKontrak": "31 Desember 2024",
                        "kontrak": "CLEAR",
                        "dokumenProses": "SUDAH",
                        "name": "Data PBJ 2025",
                        "description": "Data pengadaan SPN POLDA JATIM 2025",
                        "link": "sample_data",
                        "uploadDate": new Date().toLocaleDateString('id-ID'),
                        "uploadTime": new Date().toLocaleTimeString('id-ID'),
                        "type": "sample"
                    },
                    {
                        "id": 3,
                        "no": 3,
                        "subsaker": "URYANMA",
                        "kegiatan": "PENGADAAN JASA PAKET PEMELIHARAAN HALAMAN SPN POLDA JATIM T.A 2025",
                        "nomorKontrak": "SP/3/XII/2024/SPN",
                        "kodeMak": "BD.3096.EBA.962.003.JW.521112",
                        "nilaiKontrak": "134456000",
                        "penyedia": "CV. ALIF UTAMA",
                        "tanggalKontrak": "30 Desember 2024",
                        "tglAkhirKontrak": "31 Desember 2024",
                        "kontrak": "CLEAR",
                        "dokumenProses": "SUDAH",
                        "name": "Data PBJ 2025",
                        "description": "Data pengadaan SPN POLDA JATIM 2025",
                        "link": "sample_data",
                        "uploadDate": new Date().toLocaleDateString('id-ID'),
                        "uploadTime": new Date().toLocaleTimeString('id-ID'),
                        "type": "sample"
                    },
                    {
                        "id": 4,
                        "no": 4,
                        "subsaker": "URMANAGE",
                        "kegiatan": "PENGADAAN MAKAN DAN EKTRAFOODING PESERTA PROGRAM DIKBANGSPES FUNGSI TEKNIS DI SPN POLDA JATIM TA. 2025",
                        "nomorKontrak": "SP/4/I/2025/SPN",
                        "kodeMak": "BD.3100.DBE.009.003.AX.521112",
                        "nilaiKontrak": 875655000,
                        "penyedia": "CV. NIKMAT RASA SEJATI",
                        "tanggalKontrak": "23 Januari 2025",
                        "tglAkhirKontrak": "09 Juni 2025",
                        "kontrak": "CLEAR",
                        "dokumenProses": "SUDAH",
                        "name": "Data PBJ 2025",
                        "description": "Data pengadaan SPN POLDA JATIM 2025",
                        "link": "sample_data",
                        "uploadDate": new Date().toLocaleDateString('id-ID'),
                        "uploadTime": new Date().toLocaleTimeString('id-ID'),
                        "type": "sample"
                    },
                    {
                        "id": 5,
                        "no": 5,
                        "subsaker": "URMANAGE",
                        "kegiatan": "PENGADAAN MAKAN DAN EKTRAFOODING PESERTA PROGRAM MOP DI SPN POLDA JATIM TA. 2025",
                        "nomorKontrak": "SP/5/I/2025/SPN",
                        "kodeMak": "BD.3100.EBC.011.003.BH.521112",
                        "nilaiKontrak": 66337500,
                        "penyedia": "CV. NIKMAT RASA SEJATI",
                        "tanggalKontrak": "24 Januari 2025",
                        "tglAkhirKontrak": "09 Juni 2025",
                        "kontrak": "CLEAR",
                        "dokumenProses": "SUDAH",
                        "name": "Data PBJ 2025",
                        "description": "Data pengadaan SPN POLDA JATIM 2025",
                        "link": "sample_data",
                        "uploadDate": new Date().toLocaleDateString('id-ID'),
                        "uploadTime": new Date().toLocaleTimeString('id-ID'),
                        "type": "sample"
                    }
                ];
                localStorage.setItem('spreadsheets', JSON.stringify(spreadsheets));
            }

            tableData = spreadsheets.slice(0, 50); // Limit to 50 items for performance
            filteredData = [...tableData];
            renderTable();
        }

        // Render table
        function renderTable() {
            const tbody = document.getElementById('tableBody');
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageData = filteredData.slice(startIndex, endIndex);

            tbody.innerHTML = '';

            if (pageData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="12" class="no-data">Tidak ada data ditemukan</td></tr>';
                return;
            }

            pageData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.no || (startIndex + index + 1)}</td>
                    <td>${item.subsaker || 'Data tidak tersedia'}</td>
                    <td>${item.kegiatan || 'Data tidak tersedia'}</td>
                    <td>${item.nomorKontrak || 'Data tidak tersedia'}</td>
                    <td>${item.kodeMak || 'Data tidak tersedia'}</td>
                    <td>Rp ${item.nilaiKontrak ? item.nilaiKontrak.toLocaleString('en-US') : 'Data tidak tersedia'}</td>
                    <td>${item.penyedia || 'Data tidak tersedia'}</td>
                    <td>${item.tanggalKontrak || 'Data tidak tersedia'}</td>
                    <td>${item.tglAkhirKontrak || 'Data tidak tersedia'}</td>
                    <td><span class="status-badge ${item.kontrak === 'CLEAR' ? 'success' : 'warning'}">${item.kontrak || 'PROSES'}</span></td>
                    <td><span class="status-badge ${item.dokumenProses === 'SUDAH' ? 'success' : 'warning'}">${item.dokumenProses || 'BELUM'}</span></td>
                    <td>
                        <button class="btn-icon" onclick="viewItem(${item.id})" title="Lihat">
                            <i class="fa-solid fa-eye"></i>
                        </button>
                        <button class="btn-icon" onclick="editItem(${item.id})" title="Edit">
                            <i class="fa-solid fa-edit"></i>
                        </button>
                        <button class="btn-icon danger" onclick="deleteItem(${item.id})" title="Hapus">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            updatePagination();
        }

        // Update pagination
        function updatePagination() {
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            const pageNumbers = document.getElementById('pageNumbers');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const tableInfo = document.getElementById('tableInfo');

            // Update info
            const startItem = (currentPage - 1) * itemsPerPage + 1;
            const endItem = Math.min(currentPage * itemsPerPage, filteredData.length);
            tableInfo.textContent = `Menampilkan ${startItem} - ${endItem} dari ${filteredData.length} data`;

            // Update buttons
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;

            // Update page numbers
            pageNumbers.innerHTML = '';
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);

            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `page-number ${i === currentPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.onclick = () => goToPage(i);
                pageNumbers.appendChild(pageBtn);
            }
        }

        // Table sorting
        document.querySelectorAll('.styled-table th[data-sort]').forEach(header => {
            header.addEventListener('click', function() {
                const column = this.getAttribute('data-sort');
                if (currentSort.column === column) {
                    currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
                } else {
                    currentSort.column = column;
                    currentSort.direction = 'asc';
                }

                sortTable();
            });
        });

        function sortTable() {
            filteredData.sort((a, b) => {
                let aVal = a[currentSort.column] || '';
                let bVal = b[currentSort.column] || '';

                // Handle numeric sorting
                if (currentSort.column === 'no' || currentSort.column === 'nilaiKontrak') {
                    aVal = parseFloat(aVal) || 0;
                    bVal = parseFloat(bVal) || 0;
                } else {
                    aVal = aVal.toString().toLowerCase();
                    bVal = bVal.toString().toLowerCase();
                }

                if (currentSort.direction === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });

            currentPage = 1;
            renderTable();
        }

        // Table search
        document.getElementById('tableSearch').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            filteredData = tableData.filter(item =>
                Object.values(item).some(value =>
                    value && value.toString().toLowerCase().includes(searchTerm)
                )
            );
            currentPage = 1;
            renderTable();
        });

        // Pagination functions
        function goToPage(page) {
            currentPage = page;
            renderTable();
        }

        document.getElementById('prevBtn').addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                renderTable();
            }
        });

        document.getElementById('nextBtn').addEventListener('click', () => {
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                renderTable();
            }
        });

        // Load activity data
        function loadActivityData() {
            const activities = JSON.parse(localStorage.getItem('activities')) || [];
            const activityList = document.getElementById('activityList');

            if (activities.length === 0) {
                activityList.innerHTML = '<div class="no-activity">Belum ada aktivitas</div>';
                return;
            }

            activityList.innerHTML = '';
            activities.slice(0, 10).forEach(activity => {
                const activityItem = document.createElement('div');
                activityItem.className = 'activity-item';
                activityItem.innerHTML = `
                    <div class="activity-icon">
                        <i class="fa-solid ${activity.icon || 'fa-info-circle'}"></i>
                    </div>
                    <div class="activity-content">
                        <p>${activity.message}</p>
                        <span class="activity-time">${activity.time}</span>
                    </div>
                `;
                activityList.appendChild(activityItem);
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Sidebar toggle
            document.getElementById('sidebarToggle').addEventListener('click', toggleSidebar);
            document.getElementById('sidebarToggleMobile').addEventListener('click', toggleSidebar);

            // Notification toggle
            document.getElementById('notificationBtn').addEventListener('click', toggleNotifications);

            // Menu dropdown
            document.getElementById('menuDropdownBtn').addEventListener('click', toggleMenuDropdown);

            // Refresh button
            document.getElementById('refreshBtn').addEventListener('click', refreshDashboard);

            // Theme toggle (if exists)
            const themeToggle = document.getElementById('theme-toggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', toggleTheme);
            }

            // Close notifications when clicking outside
            document.addEventListener('click', function(e) {
                const notificationPanel = document.getElementById('notificationPanel');
                const notificationBtn = document.getElementById('notificationBtn');

                if (!notificationPanel.contains(e.target) && !notificationBtn.contains(e.target)) {
                    notificationPanel.style.display = 'none';
                }
            });
        }

        // Sidebar functions
        function toggleSidebar() {
            const sidebar = document.getElementById('adminSidebar');
            const isCollapsed = sidebar.classList.contains('collapsed');

            if (isCollapsed) {
                sidebar.classList.remove('collapsed');
                document.getElementById('sidebarToggle').setAttribute('aria-expanded', 'true');
            } else {
                sidebar.classList.add('collapsed');
                document.getElementById('sidebarToggle').setAttribute('aria-expanded', 'false');
            }
        }

        // Notification functions
        function toggleNotifications() {
            const panel = document.getElementById('notificationPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        function closeNotifications() {
            document.getElementById('notificationPanel').style.display = 'none';
        }

        // Menu dropdown
        function toggleMenuDropdown() {
            // Implement menu dropdown toggle
        }

        // Refresh dashboard
        function refreshDashboard() {
            loadDashboardData();
            loadTableData();
            loadActivityData();
            loadNotifications();
        }

        // Theme toggle
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);

            const themeIcon = document.querySelector('#theme-toggle i');
            themeIcon.className = newTheme === 'dark' ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
        }

        // Table action functions
        function viewItem(id) {
            // Implement view item
            alert('Fitur lihat detail akan segera hadir');
        }

        function editItem(id) {
            // Implement edit item
            alert('Fitur edit akan segera hadir');
        }

        function deleteItem(id) {
            if (confirm('Apakah Anda yakin ingin menghapus item ini?')) {
                // Remove from localStorage
                let spreadsheets = JSON.parse(localStorage.getItem('spreadsheets')) || [];
                spreadsheets = spreadsheets.filter(item => item.id !== id);
                localStorage.setItem('spreadsheets', JSON.stringify(spreadsheets));

                // Refresh table
                loadTableData();
                loadDashboardData();

                // Add activity
                addActivity('Data PBJ dihapus', 'fa-trash', 'danger');
            }
        }

        // Clear all table data
        function clearAllTableData() {
            if (!confirm('âš ï¸ PERINGATAN: Tindakan ini akan menghapus SEMUA data dari tabel "Data PBJ Terbaru"!\n\nData yang dihapus tidak dapat dikembalikan. Apakah Anda yakin ingin melanjutkan?')) {
                return;
            }

            try {
                // Clear spreadsheets data from localStorage
                localStorage.removeItem('spreadsheets');

                // Reset table data and refresh display
                tableData = [];
                filteredData = [];
                currentPage = 1;

                // Refresh dashboard
                loadDashboardData();
                loadTableData();

                // Add activity log
                addActivity('Semua data tabel PBJ dihapus', 'fa-trash', 'danger');

                // Show success message
                alert('âœ… Semua data tabel telah berhasil dihapus.');

            } catch (error) {
                alert(`âŒ Error: ${error.message}`);
            }
        }

        // Export table
        function exportTable() {
            const data = filteredData;
            if (data.length === 0) {
                alert('Tidak ada data untuk diekspor');
                return;
            }

            // Create CSV content
            const headers = ['NO', 'SUBSATKER', 'KEGIATAN / SUB KEGIATAN / JENIS BELANJA / RINCIAN BELANJA', 'NOMOR KONTRAK', 'KODE MAK', 'NILAI KONTRAK', 'PENYEDIA', 'TANGGAL KONTRAK', 'TGL AKHIR KONTRAK', 'KONTRAK', 'DOKUMEN PROSES'];
            const csvContent = [
                headers.join(','),
                ...data.map(item => [
                    item.no || '',
                    item.subsaker || '',
                    item.kegiatan || '',
                    item.nomorKontrak || '',
                    item.kodeMak || '',
                    item.nilaiKontrak || '',
                    item.penyedia || '',
                    item.tanggalKontrak || '',
                    item.tglAkhirKontrak || '',
                    item.kontrak || '',
                    item.dokumenProses || ''
                ].join(','))
            ].join('\n');

            // Download CSV
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `data_pbj_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Quick action functions
        function showSettings() {
            document.getElementById('settingsModal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function generateReport() {
            alert('Fitur generate laporan akan segera hadir');
        }

        function backupData() {
            const data = {
                spreadsheets: JSON.parse(localStorage.getItem('spreadsheets')) || [],
                uploads: JSON.parse(localStorage.getItem('uploads')) || [],
                activities: JSON.parse(localStorage.getItem('activities')) || [],
                timestamp: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `backup_${new Date().toISOString().split('T')[0]}.json`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            addActivity('Backup data berhasil', 'fa-save', 'success');
        }

        // Activity functions
        function addActivity(message, icon = 'fa-info-circle', type = 'info') {
            const activities = JSON.parse(localStorage.getItem('activities')) || [];
            const activity = {
                id: Date.now(),
                message: message,
                icon: icon,
                type: type,
                time: new Date().toLocaleString('id-ID')
            };

            activities.unshift(activity);
            localStorage.setItem('activities', JSON.stringify(activities.slice(0, 100))); // Keep only 100 activities
            loadActivityData();
        }

        function clearActivity() {
            if (confirm('Apakah Anda yakin ingin menghapus semua aktivitas?')) {
                localStorage.removeItem('activities');
                loadActivityData();
            }
        }

        // Logout function
        function logout() {
            if (confirm('Apakah Anda yakin ingin logout?')) {
                localStorage.removeItem('adminLoggedIn');
                window.location.href = 'login.html';
            }
        }

        // Load notifications
        function loadNotifications() {
            // This would typically load from a server, but for demo we'll use localStorage
            const notifications = JSON.parse(localStorage.getItem('notifications')) || [];
            const notificationList = document.getElementById('notificationList');
            const notificationBadge = document.querySelector('.notification-badge');

            notificationList.innerHTML = '';

            if (notifications.length === 0) {
                notificationList.innerHTML = '<div class="no-notifications">Tidak ada notifikasi</div>';
                if (notificationBadge) notificationBadge.style.display = 'none';
                return;
            }

            notifications.slice(0, 5).forEach(notification => {
                const notificationItem = document.createElement('div');
                notificationItem.className = 'notification-item';
                notificationItem.innerHTML = `
                    <div class="notification-icon">
                        <i class="fa-solid ${notification.icon || 'fa-info-circle'}"></i>
                    </div>
                    <div class="notification-content">
                        <p>${notification.message}</p>
                        <span class="notification-time">${notification.time}</span>
                    </div>
                `;
                notificationList.appendChild(notificationItem);
            });

            if (notificationBadge) {
                notificationBadge.textContent = notifications.length;
                notificationBadge.style.display = 'block';
            }
        }

        // Listen for storage changes (for cross-tab updates)
        window.addEventListener('storage', function(e) {
            if (e.key === 'spreadsheets' || e.key === 'uploads' || e.key === 'activities') {
                refreshDashboard();
            }
        });

        // Listen for custom events
        window.addEventListener('spreadsheetUploaded', function() {
            refreshDashboard();
        });
    </script>
</body>
</html>
